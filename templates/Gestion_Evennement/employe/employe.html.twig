{% extends 'Gestion_Evennement/employe/base.html.twig' %}

{% block emp %}
<div class="container mt-4">
    <h2 class=" text-center mb-4 ">Assigned_EVENT</h2>
    
    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
    
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
    
    <div class="row">
        {% for assignation in assignations %}
            {% set event = assignation.event %}
            <div class="col-md-4">
                <div class="card shadow-sm border rounded-4 p-3 mb-4" style="border: 3px solid #e02454;">
                    {% if event.imagePath %}
                        <img src="{{ asset('uploads/events/' ~ event.imagePath) }}" class="card-img-top" alt="Event Image" style="height: 200px; object-fit: cover;">
                    {% else %}
                        <div class="card-img-top bg-secondary" style="height: 200px; display: flex; align-items: center; justify-content: center;">
                            <span class="text-white">No Image</span>
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ event.nom }}</h5>
                        <p class="card-text"><strong>Description:</strong> {{ event.description|slice(0, 100) ~ (event.description|length > 100 ? '...' : '') }}</p>
                        <p><strong>Type:</strong> {{ event.type }}</p>
                        <p><strong>Location:</strong> {{ event.lieuEvenement }}</p>
                        <p><strong>Date début:</strong> {{ event.dateDebut|date('d/m/Y') }}</p>
                        <p><strong>Date fin:</strong> {{ event.dateFin|date('d/m/Y') }}</p>
                        <p><strong>Rôle:</strong> {{ assignation.role }}</p>
                        <p><strong>Statut:</strong> 
                            {% if assignation.status == 'Assigned' %}
                                <span class="badge bg-warning">En attente</span>
                            {% elseif assignation.status == 'Confirmed' %}
                                <span class="badge bg-success">Confirmé</span>
                            {% elseif assignation.status == 'Cancelled' %}
                                <span class="badge bg-danger">Annulé</span>
                            {% endif %}
                        </p>
                        <div class="mt-3">
                       
                            {% if assignation.status != 'Cancelled' %}
                                <a href="{{ path('update_assignment_status', {'id': assignation.id, 'status': 'Cancelled'}) }}" 
                                   class="btn btn-danger btn-sm">Annuler</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
                    
        {% else %}
            <div class="col-12">
                <div class="alert alert-info">
                    Vous n'avez pas encore d'événements assignés.
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<style>
    .btn-meet {
        background-color: #003a66 !important;
        border-color: #e02454;
        color: white !important;
    }
    .btn-meet:hover {
        background-color: #c81e48 !important;
        border-color: #c81e48 !important;
    }
</style>
{% endblock %}
